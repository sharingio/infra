---
# Claude system namespace for service accounts
apiVersion: v1
kind: Namespace
metadata:
  name: claude-system
  labels:
    claude.io/managed: "true"
---
# Claude sandbox namespace for operator-level testing
apiVersion: v1
kind: Namespace
metadata:
  name: claude-sandbox
  labels:
    claude.io/managed: "true"
---
# Level 1: claude-readonly
# Use case: Exploring cluster, reading logs, debugging
apiVersion: v1
kind: ServiceAccount
metadata:
  name: claude-readonly
  namespace: claude-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: claude-readonly
rules:
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["pods/log"]
    verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: claude-readonly
subjects:
  - kind: ServiceAccount
    name: claude-readonly
    namespace: claude-system
roleRef:
  kind: ClusterRole
  name: claude-readonly
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Secret
metadata:
  name: claude-readonly-token
  namespace: claude-system
  annotations:
    kubernetes.io/service-account.name: claude-readonly
type: kubernetes.io/service-account-token
---
# Level 2: claude-operator (read + execute)
# Use case: Debugging pods, running test commands, sandbox namespace access
apiVersion: v1
kind: ServiceAccount
metadata:
  name: claude-operator
  namespace: claude-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: claude-operator
rules:
  # Read everything
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["get", "list", "watch"]
  # Logs and exec
  - apiGroups: [""]
    resources: ["pods/log", "pods/exec"]
    verbs: ["get", "create"]
  # Port-forward for debugging
  - apiGroups: [""]
    resources: ["pods/portforward"]
    verbs: ["create"]
---
# Full access to sandbox namespace only
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: claude-sandbox-admin
  namespace: claude-sandbox
rules:
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["*"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: claude-operator
subjects:
  - kind: ServiceAccount
    name: claude-operator
    namespace: claude-system
roleRef:
  kind: ClusterRole
  name: claude-operator
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: claude-sandbox-admin
  namespace: claude-sandbox
subjects:
  - kind: ServiceAccount
    name: claude-operator
    namespace: claude-system
roleRef:
  kind: Role
  name: claude-sandbox-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Secret
metadata:
  name: claude-operator-token
  namespace: claude-system
  annotations:
    kubernetes.io/service-account.name: claude-operator
type: kubernetes.io/service-account-token
---
# Level 3: claude-admin (read + write + execute)
# Use case: Terraform/OCI operations, cluster bootstrapping
apiVersion: v1
kind: ServiceAccount
metadata:
  name: claude-admin
  namespace: claude-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: claude-admin
rules:
  # Full read
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["get", "list", "watch"]
  # Exec, logs, port-forward
  - apiGroups: [""]
    resources: ["pods/log", "pods/exec", "pods/portforward"]
    verbs: ["get", "create"]
  # Write to non-critical resources (terraform-managed, ephemeral)
  - apiGroups: [""]
    resources: ["configmaps", "secrets", "services", "endpoints"]
    verbs: ["create", "update", "patch", "delete"]
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["create", "delete"]
  - apiGroups: ["apps"]
    resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
    verbs: ["create", "update", "patch", "delete"]
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["create", "update", "patch", "delete"]
  # Node operations (for talos/OCI)
  - apiGroups: [""]
    resources: ["nodes"]
    verbs: ["get", "list", "watch", "patch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: claude-admin
subjects:
  - kind: ServiceAccount
    name: claude-admin
    namespace: claude-system
roleRef:
  kind: ClusterRole
  name: claude-admin
  apiGroup: rbac.authorization.k8s.io
---
apiVersion: v1
kind: Secret
metadata:
  name: claude-admin-token
  namespace: claude-system
  annotations:
    kubernetes.io/service-account.name: claude-admin
type: kubernetes.io/service-account-token
